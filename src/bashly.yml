name: ges-tool
help: CLI for GCP GenAI App Builder Enterprise Search.  
version: 0.1.0

environment_variables:
- name: gcp_project_number
  required: true
  help: Set your GCP Enterprise Search Project Number (not project id)
- name: datastore_name
  required: true
  help: Data Store name of the format <data_store>_<some_number>"
- name: gcp_access_token
  required: false
  help: Optional - GCP access-token. To be used if access-token is obtained using third party tool like Vault. If this is not set then  `gcloud auth print-access-token` is used to obtain access token. 

commands:
- name: init
  alias: i
  help: Checks for gcloud authentication and installs dependent tools

  dependencies:
  - curl
  - jq
  
- name: search
  alias: s
  help: Perform a single search query and outputs results as csv

  args:
  - name: query 
    required: true
    help: search query string
  
  flags:
  - &format
    long: --format
    short: -f
    arg: format
    help: format of output. 
    allowed: [csv, table, json]
    default: csv
    
     
- name: bsearch
  alias: b
  help: Perform a batch search using queries from an external file

  args:
  - name: input_file
    required: true
    help: Text file name containing queries. One per line. 

  flags:
    - *format
    
- name: verify
  alias: v
  help: Perform a batch search and verify using an input csv file that outputs to JSON lines.
  
  environment_variables:
  - name: project_id
    required: true
    help: GCP Project where Palm text-bison API is enabled and available
  - name: location_id
    required: true
    help: GCP Region to use for the text-bison API is enabled and available

  args:
  - name: input_file
    required: true
    help: csv file containing queries and expected results format is - 
  
  flags:
  - *format
  
examples: |-
    Single search with csv output. Only shows the summary and first document link
    $ ./ges-tool search "What is Google's revenue for year ending 2022?" 

    Single search with table output. Only shows the summary and first document link
    $ ./ges-tool s "What is Google's revenue for year ending 2022?" --format=table 

     Single search with raw json output
    $ ./ges-tool s "What is Google's revenue for year ending 2022?" -f=json 

    Batch search with input file containing search queries and output a csv file with results. Only shows the summary and first document link
    $ ./ges-tool bsearch test/data/batch_test.txt --format=table 

    Batch search AND verify with input file containing search queries and output a csv file with results.
    $ ./ges-tool verify test/data/verification_test_with_prompt.csv --format=csv
